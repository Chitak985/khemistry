// Localization patches
@PART[fft-scoop-regolith-1]:NEEDS[FarFutureTechnologies]:FOR[Khemistry]
{
	@title = #LOC_Khemistry_FFT_fft-scoop-regolith-1_title
	@description = #LOC_Khemistry_FFT_fft-scoop-regolith-1_description
}
@PART[fft-scoop-regolith-2]:NEEDS[FarFutureTechnologies]:FOR[Khemistry]
{
	@title = #LOC_Khemistry_FFT_fft-scoop-regolith-2_title
	@description = #LOC_Khemistry_FFT_fft-scoop-regolith-2_description
}

// Regolith scoops
@PART[fft-scoop-regolith-1,fft-scoop-regolith-2]:NEEDS[FarFutureTechnologies]:FOR[Khemistry]
{
	!MODULE[ModuleSystemHeatHarvester]:HAS[#moduleID[harvester]] {}  // Remove old He-3 harvester
	MODULE  // Add water ice harvester
  {
  	name = ModuleSystemHeatHarvester
    moduleID = harvesterWIce
    systemHeatModuleID = harvesterWIce
    shutdownTemperature = 750
    systemOutletTemperature = 500
  	HarvesterType = 0
  	Efficiency = 4.0
  	ResourceName = H2O
  	ConverterName = Water Ice Harvesting
  	StartActionName = Start Harvesting Water Ice
  	StopActionName = Stop Harvesting Water Ice
  	ToggleActionName = Toggle Harvesting Water Ice
  	ImpactTransform = ImpactTransform
  	ImpactRange = 2
    HarvestThreshold = 0
  	AutoShutdown = true
  	GeneratesHeat = false
  	INPUT_RESOURCE
  	{
  		ResourceName = ElectricCharge
  		Ratio = 20
  	}
  	UseSpecialistBonus = true
  	SpecialistEfficiencyFactor = 0.2
  	SpecialistBonusBase = 0.05
  	UseSpecialistHeatBonus = true
  	SpecialistHeatFactor = 0.1
  	ExperienceEffect = DrillSkill
  	EfficiencyBonus = 1
    systemEfficiency
    {
      key = 0 1.0
      key = 400 1.0
      key = 750 0.0
    }
    systemPower = 60
  }
	MODULE  // Add sand harvester
  {
  	name = ModuleSystemHeatHarvester
    moduleID = harvesterSand
    systemHeatModuleID = harvesterSand
    shutdownTemperature = 750
    systemOutletTemperature = 500
  	HarvesterType = 0
  	Efficiency = 4.0
  	ResourceName = SiO2
  	ConverterName = Sand Harvesting (SiO2)
  	StartActionName = Start Harvesting Sand
  	StopActionName = Stop Harvesting Sand
  	ToggleActionName = Toggle Harvesting Sand
  	ImpactTransform = ImpactTransform
  	ImpactRange = 2
    HarvestThreshold = 0
  	AutoShutdown = true
  	GeneratesHeat = false
  	INPUT_RESOURCE
  	{
  		ResourceName = ElectricCharge
  		Ratio = 20
  	}
  	UseSpecialistBonus = true
  	SpecialistEfficiencyFactor = 0.2
  	SpecialistBonusBase = 0.05
  	UseSpecialistHeatBonus = true
  	SpecialistHeatFactor = 0.1
  	ExperienceEffect = DrillSkill
  	EfficiencyBonus = 1
    systemEfficiency
    {
      key = 0 1.0
      key = 400 1.0
      key = 750 0.0
    }
    systemPower = 60
  }
	MODULE  // Add iron ore harvester
  {
  	name = ModuleSystemHeatHarvester
    moduleID = harvesterIron
    systemHeatModuleID = harvesterIron
    shutdownTemperature = 750
    systemOutletTemperature = 500
  	HarvesterType = 0
  	Efficiency = 3.5
  	ResourceName = Fe2O3
  	ConverterName = Iron Ore Harvesting (Fe2O3)
  	StartActionName = Start Harvesting Iron Ore
  	StopActionName = Stop Harvesting Iron Ore
  	ToggleActionName = Toggle Harvesting Iron Ore
  	ImpactTransform = ImpactTransform
  	ImpactRange = 2
    HarvestThreshold = 0
  	AutoShutdown = true
  	GeneratesHeat = false
  	INPUT_RESOURCE
  	{
  		ResourceName = ElectricCharge
  		Ratio = 25
  	}
  	UseSpecialistBonus = true
  	SpecialistEfficiencyFactor = 0.2
  	SpecialistBonusBase = 0.05
  	UseSpecialistHeatBonus = true
  	SpecialistHeatFactor = 0.1
  	ExperienceEffect = DrillSkill
  	EfficiencyBonus = 1
    systemEfficiency
    {
      key = 0 1.0
      key = 400 1.0
      key = 750 0.0
    }
    systemPower = 60
  }
	MODULE  // Add pure iron harvester
  {
  	name = ModuleSystemHeatHarvester
    moduleID = harvesterFe
    systemHeatModuleID = harvesterFe
    shutdownTemperature = 750
    systemOutletTemperature = 500
  	HarvesterType = 0
  	Efficiency = 3.0
  	ResourceName = Fe
  	ConverterName = Pure Iron Harvesting (Fe)
  	StartActionName = Start Harvesting Pure Iron
  	StopActionName = Stop Harvesting Pure Iron
  	ToggleActionName = Toggle Harvesting Pure Iron
  	ImpactTransform = ImpactTransform
  	ImpactRange = 2
    HarvestThreshold = 0
  	AutoShutdown = true
  	GeneratesHeat = false
  	INPUT_RESOURCE
  	{
  		ResourceName = ElectricCharge
  		Ratio = 30
  	}
  	UseSpecialistBonus = true
  	SpecialistEfficiencyFactor = 0.2
  	SpecialistBonusBase = 0.05
  	UseSpecialistHeatBonus = true
  	SpecialistHeatFactor = 0.1
  	ExperienceEffect = DrillSkill
  	EfficiencyBonus = 1
    systemEfficiency
    {
      key = 0 1.0
      key = 400 1.0
      key = 750 0.0
    }
    systemPower = 60
  }
	MODULE  // Add nitrogen harvester
  {
  	name = ModuleSystemHeatHarvester
    moduleID = harvesterLandNitrogen
    systemHeatModuleID = harvesterLandNitrogen
    shutdownTemperature = 750
    systemOutletTemperature = 500
  	HarvesterType = 0
  	Efficiency = 4.0
  	ResourceName = N2
  	ConverterName = Surface Nitrogen Harvesting (N2)
  	StartActionName = Start Harvesting Surface Nitrogen
  	StopActionName = Stop Harvesting Surface Nitrogen
  	ToggleActionName = Toggle Harvesting SUrface Nitrogen
  	ImpactTransform = ImpactTransform
  	ImpactRange = 2
    HarvestThreshold = 0
  	AutoShutdown = true
  	GeneratesHeat = false
  	INPUT_RESOURCE
  	{
  		ResourceName = ElectricCharge
  		Ratio = 20
  	}
  	UseSpecialistBonus = true
  	SpecialistEfficiencyFactor = 0.2
  	SpecialistBonusBase = 0.05
  	UseSpecialistHeatBonus = true
  	SpecialistHeatFactor = 0.1
  	ExperienceEffect = DrillSkill
  	EfficiencyBonus = 1
    systemEfficiency
    {
      key = 0 1.0
      key = 400 1.0
      key = 750 0.0
    }
    systemPower = 60
  }
}

//Parts/Resources
@PART[fft-antimatter-factory-1]:NEEDS[FarFutureTechnologies]:FOR[Khemistry]
{
	// Change uranium pellets recipe
  @MODULE[ModuleResourceConverter]:HAS[#modeID[heavyElements]]
  {
    @INPUT_RESOURCE:HAS[#ResourceName[FissionPellets]]
    {
      @ResourceName = UO2Pellets
    }
  }
}
@PART[fft-nuclear-smelter-375-1]:NEEDS[FarFutureTechnologies]:FOR[Khemistry]
{
	// Change nuclear salt water recipe
  @MODULE[ModuleSystemHeatConverter][#moduleID[nswConverter]]
  {
    @INPUT_RESOURCE:HAS[#ResourceName[Ore]]
    {
      @ResourceName = Br4
    }
    INPUT_RESOURCE
    {
      ResourceName = H2O
      Ratio = 2
      FlowMode = STAGE_PRIORITY_FLOW
    }
  }
	// Change uranium powder recipe
  @MODULE[ModuleSystemHeatConverter][#moduleID[fissionDustConverter]]
  {
    @INPUT_RESOURCE:HAS[#ResourceName[EnrichedUranium]]
    {
      @ResourceName = UO2
    }
		@OUTPUT_RESOURCE
		{
			@ResourceName = UO2Powder
		}
  }
	// Change uranium pellets recipe
  @MODULE[ModuleSystemHeatConverter]:HAS[#moduleID[fissionPelletsConverter]]
  {
    @INPUT_RESOURCE:HAS[#ResourceName[EnrichedUranium]]
    {
      @ResourceName = UO2Powder
    }
		@OUTPUT_RESOURCE
		{
			@ResourceName = UO2Pellets
		}
  }
	// Add explodium extraction recipe
	MODULE:NEEDS[!RealSolarSystem]
  {
    name = ModuleSystemHeatConverter
    // must be unique
    moduleID = explodiumExtraction
    // ModuleSystemHeat moduleID to link to
    systemHeatModuleID = isru
    // The shutdown temperature of the part
    shutdownTemperature = 1000

    // The temperature the system contributes to loops
    systemOutletTemperature = 600

    // Map loop temperature to system efficiency (0-1.0)
    systemEfficiency
    {
        key = 0 0.0
        key = 600 1.0
        key = 1000 1.0
        key = 1300 0.0
    }
    // Map system outlet temperature (K) to heat generation (kW)
    // Heat generation (kW)
    systemPower = 100

    ConverterName = Eve Soil Explodium Extraction
    StartActionName = Start Eve Soil Explodium Extraction
    StopActionName = Stop Eve Soil Explodium Extraction
    ToggleActionName = Toggle Eve Soil Explodium Extraction
    AutoShutdown = true
    GeneratesHeat = false
    DefaultShutoffTemp = .8
    UseSpecialistBonus = true
    SpecialistEfficiencyFactor = 0.2
    SpecialistBonusBase = 0.05
    ExperienceEffect = ConverterSkill
    EfficiencyBonus = 1


    INPUT_RESOURCE
    {
      ResourceName = EveSoil
      FlowMode = STAGE_PRIORITY_FLOW
      Ratio = 1
    }
		INPUT_RESOURCE
    {
      ResourceName = H2O
      FlowMode = STAGE_PRIORITY_FLOW
      Ratio = 10
    }
    INPUT_RESOURCE
    {
      ResourceName = ElectricCharge
      Ratio = 150
    }
    OUTPUT_RESOURCE
    {
      ResourceName = H2O2
      Ratio = 0.0005
      DumpExcess = false
    }
		// The following are basalt rock components
		OUTPUT_RESOURCE
    {
      ResourceName = Fe
      Ratio = 0.002
      DumpExcess = false
    }
		OUTPUT_RESOURCE
    {
      ResourceName = Mg
      Ratio = 0.001
      DumpExcess = false
    }
		OUTPUT_RESOURCE
    {
      ResourceName = Ca
      Ratio = 0.001
      DumpExcess = false
    }
		OUTPUT_RESOURCE
    {
      ResourceName = SiO2
      Ratio = 0.01
      DumpExcess = false
    }
  }
	// Add basaltic rock extraction recipe
	MODULE:NEEDS[RealSolarSystem]
  {
    name = ModuleSystemHeatConverter
    // must be unique
    moduleID = basaltRockExtraction
    // ModuleSystemHeat moduleID to link to
    systemHeatModuleID = isru
    // The shutdown temperature of the part
    shutdownTemperature = 1000

    // The temperature the system contributes to loops
    systemOutletTemperature = 600

    // Map loop temperature to system efficiency (0-1.0)
    systemEfficiency
    {
        key = 0 0.0
        key = 600 1.0
        key = 1000 1.0
        key = 1300 0.0
    }
    // Map system outlet temperature (K) to heat generation (kW)
    // Heat generation (kW)
    systemPower = 100

    ConverterName = Venus Basaltic Rock Extraction
    StartActionName = Start Venus Basaltic Rock Extraction
    StopActionName = Stop Venus Basaltic Rock Extraction
    ToggleActionName = Toggle Venus Basaltic Rock Extraction
    AutoShutdown = true
    GeneratesHeat = false
    DefaultShutoffTemp = .8
    UseSpecialistBonus = true
    SpecialistEfficiencyFactor = 0.2
    SpecialistBonusBase = 0.05
    ExperienceEffect = ConverterSkill
    EfficiencyBonus = 1


    INPUT_RESOURCE
    {
      ResourceName = VenusSoil
      FlowMode = STAGE_PRIORITY_FLOW
      Ratio = 1
    }
		INPUT_RESOURCE
    {
      ResourceName = H2O
      FlowMode = STAGE_PRIORITY_FLOW
      Ratio = 10
    }
    INPUT_RESOURCE
    {
      ResourceName = ElectricCharge
      Ratio = 150
    }
		// The following are basalt rock components
		OUTPUT_RESOURCE
    {
      ResourceName = Fe
      Ratio = 0.02
      DumpExcess = false
    }
		OUTPUT_RESOURCE
    {
      ResourceName = Mg
      Ratio = 0.01
      DumpExcess = false
    }
		OUTPUT_RESOURCE
    {
      ResourceName = Ca
      Ratio = 0.01
      DumpExcess = false
    }
		OUTPUT_RESOURCE
    {
      ResourceName = SiO2
      Ratio = 0.1
      DumpExcess = false
    }
  }
}

//Parts/Control/RCS
@PART[fft-rcs-arcjet-large-1,fft-rcs-arcjet-1]:NEEDS[FarFutureTechnologies]:FOR[Khemistry]
{
  @MODULE[ModuleRCSFX]
  {
    @resourceName = Li
    @PROPELLANT[Lithium]
    {
      @name = Li
    }
  }
  @MODULE[ModuleB9PartSwitch]:HAS[#moduleID[RCSFuel]]
  {
    @SUBTYPE[Lithium]
    {
      @name = Li
      @MODULE[#IDENTIFIER[ModuleRCSFX]]
      {
        @PROPELLANT[Lithium]
        {
          @name = Li
        }
      }
    }
    @SUBTYPE[Hydrogen]
    {
      @name = H2
      @MODULE[#IDENTIFIER[ModuleRCSFX]]
      {
        @PROPELLANT[LqdHydrogen]
        {
          @name = H2
        }
      }
    }
  }
}

//Parts/Engines/Antimatter
@PART[fft-antimatter-microfisson-1]:NEEDS[FarFutureTechnologies]:FOR[Khemistry]
{
  @MODULE[ModuleEnginesFX]
  {
	@PROPELLANT[FissionPellets]
    {
      @name = UO2Pellets
    }
  }
}

//Parts/Engines/Fission
@PART[fft-fission-zpinch-1]:NEEDS[FarFutureTechnologies]:FOR[Khemistry]
{
	@MODULE[ModuleEnginesFX]
	{
		@PROPELLANT
		{
			@name = UO2Pellets
		}
	}
}

//Parts/Tanks/FissionFuel
@PART[fft-fueltank-fission-25-1,fft-fueltank-fission-25-2,fft-fueltank-fission-25-3,fft-fueltank-fission-radial-1,fft-fueltank-fission-radial-2,fft-fueltank-fission-radial-3]:NEEDS[FarFutureTechnologies]:FOR[Khemistry]
{
  -RESOURCE,* { }
  @ModuleB9PartSwitch:HAS[#moduleID[fuelSwitch]]
  {
    @SUBTYPE[FissionDust]
    {
      @tankType = UO2Powder
    }
	  SUBTYPE
	  {
	    name = FissionDustPlutonium
	    title = Plutonium Powder
	    descriptionSummary = Plutonium Dioxide Powder
	    descriptionDetail = Holds Plutonium Dioxide Powder.
	    primaryColor = #c78c40
	    secondaryColor = #777777
	    transform = PlasmaTank
	    tankType =  PuO2Powder
	  }
	  SUBTYPE
	  {
	    name = FissionDustThorium
	    title = Thorium Powder
	    descriptionSummary = Thorium Dioxide Powder
	    descriptionDetail = Holds Thorium Dioxide Powder.
	    primaryColor = #c78c40
	    secondaryColor = #777777
	    transform = PlasmaTank
	    tankType =  ThO2Powder
	  }
	}
}
@PART[fft-fueltank-fission-5-1,fft-fueltank-fission-5-2]:NEEDS[FarFutureTechnologies]:FOR[Khemistry]
{
  -RESOURCE,* { }
}

//Parts/Tanks/NuclearTargets
@PART[fft-fueltank-targets-5-1,fft-fueltank-targets-5-2]:NEEDS[FarFutureTechnologies]:FOR[Khemistry]
{
  -RESOURCE,* { }
  MODULE
	{
		name = ModuleB9PartSwitch
		moduleID = fuelSwitch
		switcherDescription = Switch pellet type
		baseVolume = 3600

		SUBTYPE
		{
			name = UO2Pellets
			title = Uranium Pellets
			descriptionSummary = Uranium Dioxide Fission Pellets
      descriptionDetail = Stores Uranium Dioxide Fission Pellets.
      primaryColor = #c78c40
      secondaryColor = #777777
			tankType =  UO2Pellets
		}

		SUBTYPE
		{
			name = MOXPellets
			title = MOX Pellets
			descriptionSummary = Uranium-Plutonium (MOX) Fission Pellets
      descriptionDetail = Stores Uranium-Plutonium (MOX) Fission Pellets.
      primaryColor = #c78c40
      secondaryColor = #777777
			tankType =  MOXPellets
		}

		SUBTYPE
		{
			name = ThO2Pellets
			title = Thorium Pellets
			descriptionSummary = Thorium Dioxide Fission Pellets
      descriptionDetail = Stores Thorium Dioxide Fission Pellets.
      primaryColor = #c78c40
      secondaryColor = #777777
			tankType =  MOXPellets
		}
	}
}

//Patches/FFTTankTypes
@B9_TANK_TYPE[FissionParticles]:NEEDS[FarFutureTechnologies]:FOR[Khemistry]
{
	//@name = WrongFissionParticles
	@RESOURCE
	{
		@name = UO2Powder
	}
}
!B9_TANK_TYPE[FissionPellets]:NEEDS[FarFutureTechnologies]:FOR[Khemistry] {}
//!B9_TANK_TYPE[FusionParticles]:NEEDS[FarFutureTechnologies]:FOR[Khemistry] {}
