// Patch all parts with kerbals
@PART[*]:HAS[#CrewCapacity[>0]]:FINAL
{
    // Add packaged meals storage
    RESOURCE
    {
        name = PackagedMeals          // Add Packaged Meals
        amount = 0                    // This is changed later
        maxAmount = #$/CrewCapacity$  // Set the maximum amount to max kerbals
        @maxAmount *= 3               // 3 packaged meals per kerbal
        @amount = #$maxAmount$        // Change the initial amount to the now known maximum
    }
}

// Patch all manned parts
@PART[*]:HAS[#CrewCapacity[>0],!MODULE[KerbalSeat],@ModuleCommand]:FINAL
{
    // Add packaged meals storage
    @RESOURCE[PackagedMeals]
    {
        @maxAmount *= 2               // Increase default to 6 packaged meals per crew member
        @amount = #$maxAmount$        // Change the initial amount to the new maximum
    }
}