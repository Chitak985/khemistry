// WARNING! Custom pressurized air types are not yet stored anywhere as they need a special tank and cannot use normal cargo tanks.

///// ----- PREPARATIONS ----- /////
// Prepare Stock patches
@PART[RadialOreTank]:FINAL
{
	-RESOURCE,* { }
	MODULE
	{
		name = ModuleB9PartSwitch
		moduleID = oreSwitch
		switcherDescription = Switch ore type
		baseVolume = 75
	}
}
@PART[SmallTank]:FINAL
{
	-RESOURCE,* { }
	MODULE
	{
		name = ModuleB9PartSwitch
		moduleID = oreSwitch
		switcherDescription = Switch ore type
		baseVolume = 300
	}
}
@PART[LargeTank]:FINAL
{
	-RESOURCE,* { }
	MODULE
	{
		name = ModuleB9PartSwitch
		moduleID = oreSwitch
		switcherDescription = Switch ore type
		baseVolume = 1500
	}
}

// Prepare SSPX patches
@PART[sspx-cargo-container-25-1,sspx-cargo-container-25-2,sspx-cargo-container-25-3,sspx-cargo-container-375-1,sspx-cargo-container-375-2,sspx-cargo-container-375-3,sspx-cargo-container-radial-huge-1,sspx-cargo-container-radial-huge-2,sspx-cargo-container-radial-medium-1,sspx-cargo-container-radial-medium-2,sspx-cargo-container-radial-medium-3,sspx-cargo-container-radial-small-1,sspx-cargo-container-radial-small-2,sspx-cargo-container-radial-small-3]:NEEDS[StationPartsExpansionRedux]:FINAL
{
	@MODULE[ModuleB9PartSwitch]
	{
		!SUBTYPE,* {}
	}
}

// Prepare resource and tank types defintions
RESOURCE_DEFINITION
{
	displayName = Error
	abbreviation = ERR
	name = DummyT
	density = 1
	unitCost = 1000
	isTweakable = true
	isVisible = true
	flowMode = STAGE_PRIORITY_FLOW
	transfer = PUMP
	volume = 1
	noMagnetic = true
}
B9_TANK_TYPE
{
	noMagnetic = true
	tankMass = 0.1
	tankCost = 1
	noMagnetic = true
	name = DummyT
	RESOURCE
	{
		name = Error
		unitsPerVolume = 1
	}
	needsFixing = true
}
PLANETARY_RESOURCE
{
	ResourceName = DummyT
	ResourceType = 0
	PlanetName = error
	Distribution
	{
		PresenceChance = 100
		MinAbundance = 1
		MaxAbundance = 2
		MinAltitude = 0.8
		MaxAltitude = 3
		MinRange = 0.3
		MaxRange = 0.5
		Variance = 50
	}
}
SPACEDUST_RESOURCE
{
	resourceName = DummyAirT
	body = error
	RESOURCEBAND
	{
		name = error
		title = Error
		alwaysDiscovered = true
		alwaysIdentified = true
		bandType = Exosphere
		minAbundance = 0.001225
		maxAbundance = 0.000825
		alwaysDiscovered = true
		alwaysIdentified = false
		remoteDiscoveryScale = 1.0
		useAirDensity = True
		densityCurve
		{
			key = 0 0
			key = 1 1
			key = 12 12
		}
		distributionType = Spherical
		altUpperBound = 70
		altLowerBound = 0
		altPeak = 0
		altVariability = 0
		altFalloffType = Linear
		latUpperBound = 90
		latLowerBound = -90
		latPeak = 0
		latVariability = 0
		latFalloffType = None
	}
}

// Create a copy of Kopernicus so it can be modified freely without affecting the actual Body list
$Kopernicus:FINAL
{
	@name = Dummy
	!useOnDemand
}

////////// COPY-PASTED ELEMENTS UP NEXT //////////  (Total: 5)

// --------------- The following nodes are copy-pasted for each MaxBodyProcessed ---------------
                           // Prepare resource and tank type defintions to use during this round
$RESOURCE_DEFINITION[DummyT]:FINAL                  // Copy the template for RESOURCE_DEFINITION
{
	@name = DummySoil
}
$RESOURCE_DEFINITION[DummyT]:FINAL                  // Copy the template for RESOURCE_DEFINITION
{
	@name = DummyAir
}
$B9_TANK_TYPE[DummyT]:FINAL                                // Copy the template for B9_TANK_TYPE
{
	@name = DummySoil
}
$B9_TANK_TYPE[DummyT]:FINAL                                // Copy the template for B9_TANK_TYPE
{
	@name = DummyAir
}
$PLANETARY_RESOURCE:HAS[#ResourceName[DummyT]]:FINAL // Copy the template for PLANETARY_RESOURCE
{
	name = Dummy
	@ResourceName = DummySoil
	needsFixing = true
}
$PLANETARY_RESOURCE:HAS[#ResourceName[DummyT]]:FINAL // Copy the template for PLANETARY_RESOURCE
{
	name = Dummy2
	@ResourceName = DummyAir
	@ResourceType = 2
	needsFixing = true
}
                                                     // Copy the template for SPACEDUST_RESOURCE
$SPACEDUST_RESOURCE:HAS[#resourceName[DummyAirT]]:FINAL
{
	name = Dummy
	@resourceName = DummyAir
	name2 = nothing
	title2 = alsoNothing
}

@PART[SmallTank,LargeTank,RadialOreTank]:FINAL
{
	name2 = nothing
	name3 = alsoNothing
	needsFixing = true
}
@PART[sspx-cargo-container-25-1,sspx-cargo-container-25-2,sspx-cargo-container-25-3,sspx-cargo-container-375-1,sspx-cargo-container-375-2,sspx-cargo-container-375-3,sspx-cargo-container-radial-huge-1,sspx-cargo-container-radial-huge-2,sspx-cargo-container-radial-medium-1,sspx-cargo-container-radial-medium-2,sspx-cargo-container-radial-medium-3,sspx-cargo-container-radial-small-1,sspx-cargo-container-radial-small-2,sspx-cargo-container-radial-small-3]:FINAL
{
	name2 = nothing
	name3 = alsoNothing
	needsFixing = true
}

                              // Change anything that needs the name of the Body being processed
			 // Access the safe Body list and allow editing outside current node by using a copy
$Kopernicus[Dummy]:FINAL
{
	@name = DummyDELETEME
	bodyName = #$Body,0/name$     //Create a buffer to hold the name of the Body being processed

                                                                                // Stock patches
	*@PART[SmallTank]/name2 = #$bodyName$Soil
	*@PART[SmallTank]/name3 = Raw #$bodyName$ Soil
	*@PART[LargeTank]/name2 = #$bodyName$Soil
	*@PART[LargeTank]/name3 = Raw #$bodyName$ Soil
	*@PART[RadialOreTank]/name2 = #$bodyName$Soil
	*@PART[RadialOreTank]/name3 = Raw #$bodyName$ Soil

                                                                                 // SSPX patches
	*@PART[sspx-cargo-container-25-1]/name2 = #$bodyName$Soil
	*@PART[sspx-cargo-container-25-1]/name3 = Raw #$bodyName$ Soil
	*@PART[sspx-cargo-container-25-2]/name2 = #$bodyName$Soil
	*@PART[sspx-cargo-container-25-2]/name3 = Raw #$bodyName$ Soil
	*@PART[sspx-cargo-container-25-3]/name2 = #$bodyName$Soil
	*@PART[sspx-cargo-container-25-3]/name3 = Raw #$bodyName$ Soil
	*@PART[sspx-cargo-container-375-1]/name2 = #$bodyName$Soil
	*@PART[sspx-cargo-container-375-1]/name3 = Raw #$bodyName$ Soil
	*@PART[sspx-cargo-container-375-2]/name2 = #$bodyName$Soil
	*@PART[sspx-cargo-container-375-2]/name3 = Raw #$bodyName$ Soil
	*@PART[sspx-cargo-container-375-3]/name2 = #$bodyName$Soil
	*@PART[sspx-cargo-container-375-3]/name3 = Raw #$bodyName$ Soil
	*@PART[sspx-cargo-container-radial-huge-1]/name2 = #$bodyName$Soil
	*@PART[sspx-cargo-container-radial-huge-1]/name3 = Raw #$bodyName$ Soil
	*@PART[sspx-cargo-container-radial-huge-2]/name2 = #$bodyName$Soil
	*@PART[sspx-cargo-container-radial-huge-2]/name3 = Raw #$bodyName$ Soil
	*@PART[sspx-cargo-container-radial-medium-1]/name2 = #$bodyName$Soil
	*@PART[sspx-cargo-container-radial-medium-1]/name3 = Raw #$bodyName$ Soil
	*@PART[sspx-cargo-container-radial-medium-2]/name2 = #$bodyName$Soil
	*@PART[sspx-cargo-container-radial-medium-2]/name3 = Raw #$bodyName$ Soil
	*@PART[sspx-cargo-container-radial-medium-3]/name2 = #$bodyName$Soil
	*@PART[sspx-cargo-container-radial-medium-3]/name3 = Raw #$bodyName$ Soil
	*@PART[sspx-cargo-container-radial-small-1]/name2 = #$bodyName$Soil
	*@PART[sspx-cargo-container-radial-small-1]/name3 = Raw #$bodyName$ Soil
	*@PART[sspx-cargo-container-radial-small-2]/name2 = #$bodyName$Soil
	*@PART[sspx-cargo-container-radial-small-2]/name3 = Raw #$bodyName$ Soil
	*@PART[sspx-cargo-container-radial-small-3]/name2 = #$bodyName$Soil
	*@PART[sspx-cargo-container-radial-small-3]/name3 = Raw #$bodyName$ Soil

          // Change the temporary resource and tank type definitions to hold the buffer bodyName
	*@RESOURCE_DEFINITION[DummySoil]/displayName = Raw #$bodyName$ Soil
	*@RESOURCE_DEFINITION[DummySoil]/abbreviation = #$bodyName$ Soil
	*@RESOURCE_DEFINITION[DummySoil]/name = #$bodyName$Soil

	*@RESOURCE_DEFINITION[DummyAir]/displayName = #$bodyName$ Air
	*@RESOURCE_DEFINITION[DummyAir]/abbreviation = #$bodyName$Air
	*@RESOURCE_DEFINITION[DummyAir]/name = #$bodyName$Air

	*@B9_TANK_TYPE[DummySoil]/name = #$bodyName$Soil

	*@B9_TANK_TYPE[DummyAir]/name = #$bodyName$Air

	*@PLANETARY_RESOURCE[Dummy]/ResourceName = #$bodyName$Soil
	*@PLANETARY_RESOURCE[Dummy]/PlanetName = #$bodyName$

	*@PLANETARY_RESOURCE[Dummy2]/ResourceName = #$bodyName$Air
	*@PLANETARY_RESOURCE[Dummy2]/PlanetName = #$bodyName$

	*@SPACEDUST_RESOURCE[Dummy]/resourceName = #$bodyName$Air
	*@SPACEDUST_RESOURCE[Dummy]/body = #$bodyName$
	*@SPACEDUST_RESOURCE[Dummy]/name2 = #$bodyName$Atmo
	*@SPACEDUST_RESOURCE[Dummy]/title2 = #$bodyName$ Atmosphere
}

!Kopernicus[DummyDELETEME]:FINAL {}                                   // Delete the useless copy

@PLANETARY_RESOURCE[*]:HAS[#needsFixing[true]]:FINAL
{
	!needsFixing
	!name
}
@B9_TANK_TYPE[*]:HAS[#needsFixing[true]]:FINAL
{
	!needsFixing
	@RESOURCE
	{
		@name = #$../name$
	}
}
@SPACEDUST_RESOURCE[*]:HAS[#needsFixing[true]]:FINAL
{
	!needsFixing
	@RESOURCEBAND
	{
		@name = #$../name2$
		@title = #$../title2$
	}
	!name2
	!title2
	!name
}
@PART[SmallTank,LargeTank,RadialOreTank]:HAS[#needsFixing[true]]:FINAL
{
	!needsFixing
	@MODULE[ModuleB9PartSwitch]
	{
		SUBTYPE
		{
			name = #$../../name2$
			tankType = #$../../name2$
			title = #$../../name3$
		}
	}
	!name2
	!name3
}
@PART[sspx-cargo-container-25-1,sspx-cargo-container-25-2,sspx-cargo-container-25-3,sspx-cargo-container-375-1,sspx-cargo-container-375-2,sspx-cargo-container-375-3,sspx-cargo-container-radial-huge-1,sspx-cargo-container-radial-huge-2,sspx-cargo-container-radial-medium-1,sspx-cargo-container-radial-medium-2,sspx-cargo-container-radial-medium-3,sspx-cargo-container-radial-small-1,sspx-cargo-container-radial-small-2,sspx-cargo-container-radial-small-3]:HAS[#needsFixing[true]]:FINAL
{
	!needsFixing
	@MODULE[ModuleB9PartSwitch]
	{
		SUBTYPE
		{
			name = #$../../name2$
			tankType = #$../../name2$
			title = #$../../name3$
		}
	}
	!name2
	!name3
}

@Kopernicus[Dummy]:FINAL
{
	!Body,0 {}                                                      // Delete the processed Body
}

// --------------------------------------------------------------------------------------------

////////// COPY-PASTED ELEMENTS END //////////

!Kopernicus[Dummy]:FINAL {}  //Delete the no longer needed safe Body list

// Delete all resource and tank type definition
!RESOURCE_DEFINITION[DummyT]:FINAL {}
!RESOURCE_DEFINITION[DummyT]:FINAL {}
!B9_TANK_TYPE[DummyT]:FINAL {}
!B9_TANK_TYPE[DummyT]:FINAL {}
!PLANETARY_RESOURCE:HAS[#ResourceName[DummyT]]:FINAL {}
!PLANETARY_RESOURCE:HAS[#ResourceName[DummyT]]:FINAL {}
!SPACEDUST_RESOURCE:HAS[#resourceName[DummyAirT]]:FINAL {}