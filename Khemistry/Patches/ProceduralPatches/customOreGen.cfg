// WARNING! Custom pressurized air types are not yet stored anywhere as they need a special tank and cannot use normal cargo tanks.

// Prepare Stock patches
@PART[RadialOreTank]:FINAL
{
	-RESOURCE,* { }
  @MODULE[ModuleB9PartSwitch]
  {
    	@baseVolume = 75
  }
}
@PART[SmallTank]:FINAL
{
  -RESOURCE,* { }
  @MODULE[ModuleB9PartSwitch]
	{
  	@baseVolume = 300
  }
}
@PART[LargeTank]:FINAL
{
	-RESOURCE,* { }
  @MODULE[ModuleB9PartSwitch]
  {
    @baseVolume = 1500
  }
}

// Prepare SSPX patches
@PART[sspx-cargo-container-25-1,sspx-cargo-container-25-2,sspx-cargo-container-25-3,sspx-cargo-container-375-1,sspx-cargo-container-375-2,sspx-cargo-container-375-3,sspx-cargo-container-radial-huge-1,sspx-cargo-container-radial-huge-2,sspx-cargo-container-radial-medium-1,sspx-cargo-container-radial-medium-2,sspx-cargo-container-radial-medium-3,sspx-cargo-container-radial-small-1,sspx-cargo-container-radial-small-2,sspx-cargo-container-radial-small-3]:NEEDS[StationPartsExpansionRedux]
{
	@MODULE[ModuleB9PartSwitch]
	{
		!SUBTYPE[Ore] {}
	}
}

// Create a copy of Kopernicus so it can be modified freely without affecting the actual Body list
$Kopernicus:FINAL
{
  _| = FakeKopernicus
}

//  ------ The following nodes are copy-pasted for each MaxBodyProcessed ------
$FakeKopernicus:HAS[Body]:FINAL                      // Copy the safe Body list
{
  name = #$Body,0/name$                      // Take the name of the first Body
  !Body,* {}                                        // Delete everything unused
  |_ = FakeKopernicus2   // Rename the node to separate from the safe Body list
}

                                                               // Stock patches
@PART[SmallTank,LargeTank,RadialOreTank]:FINAL  // Access all stock cargo tanks
{
	@MODULE[ModuleB9PartSwitch]      // Access the prepared B9 Part Switch module
	{
		SUBTYPE                             // Insert a subtype for the custom soil
    {
      name = #$Body,0/name$Soil                     // Use the custom soil name
      tankType = #$Body,0/name$Soil                 // Use the custom soil name
      title = Raw #$Body,0/name$ Soil               // Use the custom soil name
    }
	}
}

                          // Acess all SSPX cargo containers if SSPX is present
@PART[sspx-cargo-container-25-1,sspx-cargo-container-25-2,sspx-cargo-container-25-3,sspx-cargo-container-375-1,sspx-cargo-container-375-2,sspx-cargo-container-375-3,sspx-cargo-container-radial-huge-1,sspx-cargo-container-radial-huge-2,sspx-cargo-container-radial-medium-1,sspx-cargo-container-radial-medium-2,sspx-cargo-container-radial-medium-3,sspx-cargo-container-radial-small-1,sspx-cargo-container-radial-small-2,sspx-cargo-container-radial-small-3]:NEEDS[StationPartsExpansionRedux]
{
	@MODULE[ModuleB9PartSwitch]      // Access the prepared B9 Part Switch module
	{
		SUBTYPE                             // Insert a subtype for the custom soil
    {
      name = #$Body,0/name$Soil                     // Use the custom soil name
      tankType = #$Body,0/name$Soil                 // Use the custom soil name
      title = Raw #$Body,0/name$ Soil               // Use the custom soil name
    }
	}
}

@FakeKopernicus:HAS[Body]:FINAL                    // Access the safe Body list
{
  !Body,0 {}                                       // Delete the processed Body
}
// ----------------------------------------------------------------------------

!FakeKopernicus,* {}  //Delete all Body buffers (all just in case)

$FakeKopernicus2,*  //RESOURCE_DEFINITION (Soil)
{
  displayName = Raw #$name$ Soil
	abbreviation = #$name$Soil
	@name = #$name$Soil
  density = 1
	unitCost = 1000
	isTweakable = true
	isVisible = true
	flowMode = STAGE_PRIORITY_FLOW
	transfer = PUMP
	volume = 1
	noMagnetic = true
  |_ = RESOURCE_DEFINITION
}

$FakeKopernicus2,*  //RESOURCE_DEFINITION (Air)
{
  displayName = Pressurized #$name$ Air
	abbreviation = #$name$Air
	@name = #$name$Air
  density = 1
	unitCost = 1000
	isTweakable = true
	isVisible = true
	flowMode = STAGE_PRIORITY_FLOW
	transfer = PUMP
	volume = 1
	noMagnetic = true
  |_ = RESOURCE_DEFINITION
}

$FakeKopernicus2,*  //B9_TANK_TYPE (Soil)
{
  RESOURCE
	{
		name = #$../name$Soil
		unitsPerVolume = 1
	}
  tankMass = 0.1
	tankCost = 1
	noMagnetic = true
	@name = #$../name$Soil
  |_ = B9_TANK_TYPE
}

$FakeKopernicus2,*  //B9_TANK_TYPE (Air)
{
  RESOURCE
	{
		name = #$../name$Air
		unitsPerVolume = 1
	}
  tankMass = 0.1
	tankCost = 1
	noMagnetic = true
	@name = #$name$Air
  |_ = B9_TANK_TYPE
}

$FakeKopernicus2,*  //PLANETARY_RESOURCE (Soil)
{
	ResourceName = #$name$Soil
	!name
  tankMass = 0.1
	tankCost = 1
	noMagnetic = true
  |_ = B9_TANK_TYPE
}

$FakeKopernicus2,*  //PLANETARY_RESOURCE (Air)
{
	ResourceName = #$name$Air
	!name
  tankMass = 0.1
	tankCost = 1
	noMagnetic = true
  |_ = B9_TANK_TYPE
}

$FakeKopernicus2,*  //SPACEDUST_RESOURCE (Air)
{
	resourceName = #$name$Air
	body = #$name$
	RESOURCEBAND
	{
		name = #$../name$Atmo
		title = #$../name$ Atmosphere
		// Discoverability Data
		// --------------
		alwaysDiscovered = true
		alwaysIdentified = true
		bandType = Exosphere
		// Maximum and minimum abundances (variation is by game seed)
		// In t/m^3
		minAbundance = 0.001225
		maxAbundance = 0.000825
			
		// Discoverability Data
		// --------------
		alwaysDiscovered = true
		alwaysIdentified = false
	
		// The lower this number, the longer the band will take to discover with a Remote telescope
		remoteDiscoveryScale = 1.0
	
		
		// Scale abundances by air density
		useAirDensity = True
		// Map air density to scaling factors
		densityCurve
		{
			key = 0 0
			key = 1 1
			key = 12 12
		}
		// Distribution model to use, can be Uniform or Spherical
		distributionType = Spherical
	
		// These parameters are specific to the Spherical model
		// -------
		// Altitudes are in km from sea level
		// Maximum altitude for a distribution
		altUpperBound = 70
		// minimum altitude for a distribution
		altLowerBound = 0
		// peak of a distribution
		altPeak = 0
		// maximum variation of these altitudes (variation is by game seed)
		altVariability = 0
		// Falloff for altitude, can be Linear or None
		altFalloffType = Linear
			
		// lats in degrees
		// Maximum latitude for a distribution
		latUpperBound = 90
		// Minimum latitude for a distribution
		latLowerBound = -90
		// peak of a distribution
		latPeak = 0
		// maximum variation of these latitudes (variation is by game seed)
		latVariability = 0
		// Falloff for latitude, can be Linear or None
		latFalloffType = None
	}
	!name
}

!FakeKopernicus2,*  //Clean up
