// WARNING! Custom pressurized air types are not yet stored anywhere as they need a special tank and cannot use normal cargo tanks.

///// ----- PREPARATIONS ----- /////
// Prepare Stock patches
@PART[RadialOreTank]:FINAL
{
	-RESOURCE,* { }
	MODULE
	{
		name = ModuleB9PartSwitch
		moduleID = oreSwitch
		switcherDescription = Switch ore type
		baseVolume = 75
	}
}
@PART[SmallTank]:FINAL
{
	-RESOURCE,* { }
	MODULE
	{
		name = ModuleB9PartSwitch
		moduleID = oreSwitch
		switcherDescription = Switch ore type
		baseVolume = 300
	}
}
@PART[LargeTank]:FINAL
{
	-RESOURCE,* { }
	MODULE
	{
		name = ModuleB9PartSwitch
		moduleID = oreSwitch
		switcherDescription = Switch ore type
		baseVolume = 1500
	}
}

// Prepare SSPX patches
@PART[sspx-cargo-container-25-1,sspx-cargo-container-25-2,sspx-cargo-container-25-3,sspx-cargo-container-375-1,sspx-cargo-container-375-2,sspx-cargo-container-375-3,sspx-cargo-container-radial-huge-1,sspx-cargo-container-radial-huge-2,sspx-cargo-container-radial-medium-1,sspx-cargo-container-radial-medium-2,sspx-cargo-container-radial-medium-3,sspx-cargo-container-radial-small-1,sspx-cargo-container-radial-small-2,sspx-cargo-container-radial-small-3]:NEEDS[StationPartsExpansionRedux]:FINAL
{
	@MODULE[ModuleB9PartSwitch]
	{
		!SUBTYPE,* {}
	}
}

// Prepare resource and tank types defintions
RESOURCE_DEFINITION
{
	name = DummyT
	density = 1
	unitCost = 1000
	isTweakable = true
	isVisible = true
	flowMode = STAGE_PRIORITY_FLOW
	transfer = PUMP
	volume = 1
	noMagnetic = true
}
B9_TANK_TYPE
{
	noMagnetic = true
	tankMass = 0.1
	tankCost = 1
	noMagnetic = true
	name = DummyT
	needsFixing = true
}
PLANETARY_RESOURCE
{
	ResourceName = DummyT
	ResourceType = 0
	Distribution
	{
		PresenceChance = 100
		MinAbundance = 1
		MaxAbundance = 2
		MinAltitude = 0.8
		MaxAltitude = 3
		MinRange = 0.3
		MaxRange = 0.5
		Variance = 50
	}
}
SPACEDUST_RESOURCE
{
	resourceName = DummyAirT
	RESOURCEBAND
	{
		alwaysDiscovered = true
		alwaysIdentified = true
		bandType = Exosphere
		minAbundance = 0.001225
		maxAbundance = 0.000825
		alwaysDiscovered = true
		alwaysIdentified = false
		remoteDiscoveryScale = 1.0
		useAirDensity = True
		densityCurve
		{
			key = 0 0
			key = 1 1
			key = 12 12
		}
		distributionType = Spherical
		altUpperBound = 70
		altLowerBound = 0
		altPeak = 0
		altVariability = 0
		altFalloffType = Linear
		latUpperBound = 90
		latLowerBound = -90
		latPeak = 0
		latVariability = 0
		latFalloffType = None
	}
}

// Create a copy of Kopernicus so it can be modified freely without affecting the actual Body list
$Kopernicus:FINAL
{
	@name = Dummy
	!useOnDemand = DELETE
}

////////// COPY-PASTED ELEMENTS UP NEXT //////////

// --------------- The following nodes are copy-pasted for each MaxBodyProcessed ---------------
@Kopernicus[Dummy]:FINAL
{
	allowed = false
}
@Kopernicus[Dummy]:FINAL:HAS[Body[*]]
{
	@allowed = true
}
@Kopernicus[Dummy]:FINAL
{
	@Body,0
	{
		templateExists = false
		scaledVersionExists = false
	}
	@Body,0:HAS[Template[*]]
	{
		@templateExists = true
		@Template
		{
			airAllowed = true
		}
		@Template:HAS[#name[Sun]]
		{
			@airAllowed = false
		}
	}
	@Body,0:HAS[ScaledVersion[*]]
	}
		@scaledVersionExists = true
		@ScaledVersion
		{
			airAllowed = true
		}
		@ScaledVersion:HAS[#type[Star]]
		{
			@airAllowed = false
		}
	}
	Body,0
	{
		templateAir = false
	}
	@Body,0:HAS[#templateExists[true]]
	{
		templateAir = #$Template/airAllowed$
	}
}

$RESOURCE_DEFINITION[DummyT]:FINAL                  // Copy the template for RESOURCE_DEFINITION
{
	@name = DummyTMP
	displayName = Raw Soil (see abbreviation)
	allowed = #$/@Kopernicus[Dummy]/allowed$
}
@RESOURCE_DEFINITION[DummyTMP]:FINAL:HAS[#allowed[true]]
{
	@name = #$/@Kopernicus[Dummy]/Body,0/name$Soil
	abbreviation = #$/@Kopernicus[Dummy]/Body,0/name$Soil
	!allowed = DELETE
}
!RESOURCE_DEFINITION[DummyTMP]:FINAL:HAS[#allowed[false]] {}

$RESOURCE_DEFINITION[DummyT]:FINAL
{
	@name = DummyTMP
	displayName = Raw Soil (see abbreviation)
	allowed = #$/@Kopernicus[Dummy]/allowed$
}
@RESOURCE_DEFINITION[DummyTMP]:FINAL:HAS[#allowed[true]]
{
	@name = #$/@Kopernicus[Dummy]/Body,0/name$Air
	abbreviation = #$/@Kopernicus[Dummy]/Body,0/name$Air
	!allowed = DELETE
}
!RESOURCE_DEFINITION[DummyTMP]:FINAL:HAS[#allowed[false]] {}

$B9_TANK_TYPE[DummyT]:FINAL                                // Copy the template for B9_TANK_TYPE
{
	@name = DummyTMP
	RESOURCE
	{
		unitsPerVolume = 1
	}
	allowed = #$/@Kopernicus[Dummy]/allowed$
}
@B9_TANK_TYPE[DummyTMP]:FINAL:HAS[#allowed[true]]
{
	@name = #$/@Kopernicus[Dummy]/Body,0/name$Soil
	@RESOURCE
	{
		name = #$/@Kopernicus[Dummy]/Body,0/name$Soil
	}
	!allowed = DELETE
}
!B9_TANK_TYPE[DummyTMP]:FINAL:HAS[#allowed[false]] {}

$B9_TANK_TYPE[DummyT]:FINAL                                // Copy the template for B9_TANK_TYPE
{
	@name = DummyTMP
	RESOURCE
	{
		unitsPerVolume = 3
	}
	allowed = #$/@Kopernicus[Dummy]/allowed$
}
@B9_TANK_TYPE[DummyTMP]:FINAL:HAS[#allowed[true]]
{
	@name = #$/@Kopernicus[Dummy]/Body,0/name$Air
	@RESOURCE
	{
		name = #$/@Kopernicus[Dummy]/Body,0/name$Air
	}
	!allowed = DELETE
}
!B9_TANK_TYPE[DummyTMP]:FINAL:HAS[#allowed[false]] {}

$PLANETARY_RESOURCE:HAS[#ResourceName[DummyT]]:FINAL // Copy the template for PLANETARY_RESOURCE
{
	@ResourceName = DummyTMP
	allowed = #$/@Kopernicus[Dummy]/allowed$
}
@PLANETARY_RESOURCE:HAS[#ResourceName[DummyTMP]&#allowed[true]]:FINAL
{
	@ResourceName = #$/@Kopernicus[Dummy]/Body,0/name$Soil
	PlanetName = #$/@Kopernicus[Dummy]/Body,0/name$
	!allowed = DELETE
}
!PLANETARY_RESOURCE[DummyTMP]:FINAL:HAS[#allowed[false]] {}

$PLANETARY_RESOURCE:HAS[#ResourceName[DummyT]]:FINAL // Copy the template for PLANETARY_RESOURCE
{
	@ResourceName = DummyTMP
	@ResourceType = 2
	allowed = #$/@Kopernicus[Dummy]/allowed$
}
@PLANETARY_RESOURCE:HAS[#ResourceName[DummyTMP]&#allowed[true]]:FINAL
{
	@ResourceName = #$/@Kopernicus[Dummy]/Body,0/name$Air
	PlanetName = #$/@Kopernicus[Dummy]/Body,0/name$
	!allowed = DELETE
}
!PLANETARY_RESOURCE[DummyTMP]:FINAL:HAS[#allowed[false]] {}

                                                     // Copy the template for SPACEDUST_RESOURCE
$SPACEDUST_RESOURCE:HAS[#resourceName[DummyAirT]]:FINAL
{
	@resourceName = DummyTMP
	allowed = #$/@Kopernicus[Dummy]/allowed$
}
@SPACEDUST_RESOURCE:HAS[#resourceName[DummyTMP]&#allowed[true]]:FINAL
{
	@resourceName = #$/@Kopernicus[Dummy]/Body,0/name$Air
	body = #$/@Kopernicus[Dummy]/Body,0/name$
	@RESOURCEBAND
	{
		name = #$/@Kopernicus[Dummy]/Body,0/name$Atmo
		title = #$/@Kopernicus[Dummy]/Body,0/name$ Atmosphere
	}
	!allowed = DELETE
}
!SPACEDUST_RESOURCE[DummyTMP]:FINAL:HAS[#allowed[false]] {}

@PART[SmallTank,LargeTank,RadialOreTank]:FINAL
{
	allowed = #$/@Kopernicus[Dummy]/allowed$
}
@PART[SmallTank,LargeTank,RadialOreTank]:FINAL:HAS[#allowed[true]]
{
	@MODULE[ModuleB9PartSwitch]
	{
		SUBTYPE
		{
			name = #$/@Kopernicus[Dummy]/Body,0/name$Soil
			tankType = #$/@Kopernicus[Dummy]/Body,0/name$Soil
			title = Raw Soil (see resource)
		}
	}
	!allowed = DELETE
}
!@PART[SmallTank,LargeTank,RadialOreTank]:FINAL:HAS[#allowed[false]] {}

@PART[SmallTank,LargeTank,RadialOreTank]:FINAL
{
	allowed = #$/@Kopernicus[Dummy]/allowed$
}
@PART[sspx-cargo-container-25-1,sspx-cargo-container-25-2,sspx-cargo-container-25-3,sspx-cargo-container-375-1,sspx-cargo-container-375-2,sspx-cargo-container-375-3,sspx-cargo-container-radial-huge-1,sspx-cargo-container-radial-huge-2,sspx-cargo-container-radial-medium-1,sspx-cargo-container-radial-medium-2,sspx-cargo-container-radial-medium-3,sspx-cargo-container-radial-small-1,sspx-cargo-container-radial-small-2,sspx-cargo-container-radial-small-3]:FINAL:HAS[#allowed[true]]
{
	@MODULE[ModuleB9PartSwitch]
	{
		SUBTYPE
		{
			name = #$/@Kopernicus[Dummy]/Body,0/name$Soil
			tankType = #$/@Kopernicus[Dummy]/Body,0/name$Soil
			title = Raw Soil (see resource)
		}
	}
	!allowed = DELETE
}
!PART[sspx-cargo-container-25-1,sspx-cargo-container-25-2,sspx-cargo-container-25-3,sspx-cargo-container-375-1,sspx-cargo-container-375-2,sspx-cargo-container-375-3,sspx-cargo-container-radial-huge-1,sspx-cargo-container-radial-huge-2,sspx-cargo-container-radial-medium-1,sspx-cargo-container-radial-medium-2,sspx-cargo-container-radial-medium-3,sspx-cargo-container-radial-small-1,sspx-cargo-container-radial-small-2,sspx-cargo-container-radial-small-3]:FINAL:HAS[#allowed[false]] {}

@Kopernicus[Dummy]:FINAL
{
	!Body,0 {}                                                      // Delete the processed Body
	!allowed = DELETE
}
// --------------------------------------------------------------------------------------------

////////// COPY-PASTED ELEMENTS END //////////

!Kopernicus[Dummy]:FINAL {}  //Delete the no longer needed safe Body list

// Delete all resource and tank type definition templates
!RESOURCE_DEFINITION[DummyT]:FINAL {}
!RESOURCE_DEFINITION[DummyT]:FINAL {}
!B9_TANK_TYPE[DummyT]:FINAL {}
!B9_TANK_TYPE[DummyT]:FINAL {}
!PLANETARY_RESOURCE:HAS[#ResourceName[DummyT]]:FINAL {}
!PLANETARY_RESOURCE:HAS[#ResourceName[DummyT]]:FINAL {}
!SPACEDUST_RESOURCE:HAS[#resourceName[DummyAirT]]:FINAL {}
