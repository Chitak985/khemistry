// ----- EVA PATCHES -----
@PART[kerbalEVA*]:FINAL
{
  @MODULE[KerbalEVA]
  {
    @propellantResourceName = N2H4
  }

  // This won't do anything in KSP 1.11+
  @RESOURCE[EVA?Propellant]
  {
    @name = N2H4
    @amount = 0
    @maxAmount = 5
  }
}

// KSP 1.11+ handling : propellant is stored on the jetpack inventory part
@PART[evaJetpack]:FINAL
{
  @RESOURCE[EVA?Propellant]
  {
    @name = N2H4
  }
}

// Patch the 1.11+ "eva fuel cylinders" inventory item with MP
@PART[evaCylinder]:FINAL
{
  @RESOURCE[EVA?Propellant]
  {
    @name = N2H4
  }
}

// ----- REMOVE STOCK CONVERTING -----
@PART[ISRU]:FINAL
{
	!MODULE[ModuleResourceConverter],*
}

// ----- PACKAGED MEALS -----
@PART[ISRU]:FINAL
{
	MODULE
	{
		name = ModuleResourceConverter
		ConverterName = Meal Packaging
		StartActionName = Start Meal Packaging
		StopActionName = Stop Meal Packaging
		AutoShutdown = true
		TemperatureModifier
		{
			key = 0 10000
			key = 750 5000
			key = 1000 1000
			key = 1250 50
			key = 2000 5
			key = 4000 0
		}				
		GeneratesHeat = true  // I'm afraid to turn this off lmfao
		DefaultShutoffTemp = .8
		ThermalEfficiency 
		{
			key = 0 0 0 0
			key = 500 0.1 0 0
			key = 1000 1.0 0 0
			key = 1250 0.1 0 0
			key = 3000 0 0 0 
		}
		
		UseSpecialistBonus = true
		SpecialistEfficiencyFactor = 0.3
		SpecialistBonusBase = 0.1
		UseSpecialistHeatBonus = true
		SpecialistHeatFactor = 0.2
		ExperienceEffect = ConverterSkill
		EfficiencyBonus = 1
		resourceOutputName = Packaged Meals

		// Maybe a balanced diet?
		INPUT_RESOURCE
		{
			ResourceName = Cx(H2O)y
			Ratio = 0.2
			FlowMode = STAGE_PRIORITY_FLOW
  		}
		INPUT_RESOURCE
		{
			ResourceName = C18H32O2
			Ratio = 0.2
			FlowMode = STAGE_PRIORITY_FLOW
  		}
		INPUT_RESOURCE
		{
			ResourceName = C3H5(OCOR)3
			Ratio = 0.2
			FlowMode = STAGE_PRIORITY_FLOW
  		}
		INPUT_RESOURCE
		{
			ResourceName = C12(H2O)11
			Ratio = 0.1
			FlowMode = STAGE_PRIORITY_FLOW
  		}
		INPUT_RESOURCE
		{
			ResourceName = C18H32O2
			Ratio = 0.2
			FlowMode = STAGE_PRIORITY_FLOW
  		}
		INPUT_RESOURCE
		{
			ResourceName = R-CH(NH2)-COOH
			Ratio = 0.1
			FlowMode = STAGE_PRIORITY_FLOW
  		}
		INPUT_RESOURCE
		{
			ResourceName = ElectricCharge
			Ratio = 20
		}
		OUTPUT_RESOURCE
		{
			ResourceName = PackagedMeals
			Ratio = 1
			DumpExcess = false
			FlowMode = STAGE_PRIORITY_FLOW
		}
	}
}

// ----- ORE PLACEMENT -----
// -- Bop --
BIOME_RESOURCE
{
	ResourceName = H2O
	ResourceType = 0
	PlanetName = Bop
	BiomeName = Poles

	Distribution
	{
		PresenceChance = 100
		MinAbundance = 0.000005
		MaxAbundance = 0.000007
		Variance = 2
		Dispersal = 2
	}
}
BIOME_RESOURCE
{
	ResourceName = H2O
	ResourceType = 0
	PlanetName = Bop
	BiomeName = Peaks

	Distribution
	{
		PresenceChance = 10
		MinAbundance = 0.000000007
		MaxAbundance = 0.00000001
		Variance = 5
		Dispersal = 5
	}
}

// -- Dres --
BIOME_RESOURCE
{
	ResourceName = H2O
	ResourceType = 0
	PlanetName = Dres
	BiomeName = Poles

	Distribution
	{
		PresenceChance = 100
		MinAbundance = 0.000005
		MaxAbundance = 0.000007
		Variance = 2
		Dispersal = 2
	}
}

// -- Duna --
BIOME_RESOURCE
{
	ResourceName = H2O
	ResourceType = 0
	PlanetName = Duna
	BiomeName = Poles

	Distribution
	{
		PresenceChance = 100
		MinAbundance = 0.00005
		MaxAbundance = 0.00009
		Variance = 3
		Dispersal = 2
	}
}
BIOME_RESOURCE
{
	ResourceName = H2O
	ResourceType = 0
	PlanetName = Duna
	BiomeName = Polar Highlands

	Distribution
	{
		PresenceChance = 95
		MinAbundance = 0.000008
		MaxAbundance = 0.000015
		Variance = 4
		Dispersal = 4
	}
}
BIOME_RESOURCE
{
	ResourceName = H2O
	ResourceType = 0
	PlanetName = Duna
	BiomeName = Polar Craters

	Distribution
	{
		PresenceChance = 75
		MinAbundance = 0.0000003
		MaxAbundance = 0.000001
		Variance = 5
		Dispersal = 3
	}
}

// -- Eeloo --
BIOME_RESOURCE
{
	ResourceName = H2O
	ResourceType = 0
	PlanetName = Eeloo
	BiomeName = Poles

	Distribution
	{
		PresenceChance = 100
		MinAbundance = 0.0003
		MaxAbundance = 0.001
		Variance = 2
		Dispersal = 2
	}
}
BIOME_RESOURCE
{
	ResourceName = H2O
	ResourceType = 0
	PlanetName = Eeloo
	BiomeName = Northern Glaciers

	Distribution
	{
		PresenceChance = 100
		MinAbundance = 0.009
		MaxAbundance = 0.01
		Variance = 2
		Dispersal = 2
	}
}
BIOME_RESOURCE
{
	ResourceName = H2O
	ResourceType = 0
	PlanetName = Eeloo
	BiomeName = Lowlands

	Distribution
	{
		PresenceChance = 60
		MinAbundance = 0.000001
		MaxAbundance = 0.00001
		Variance = 4
		Dispersal = 4
	}
}
BIOME_RESOURCE
{
	ResourceName = H2O
	ResourceType = 0
	PlanetName = Eeloo
	BiomeName = Highlands

	Distribution
	{
		PresenceChance = 40
		MinAbundance = 0.000002
		MaxAbundance = 0.00001
		Variance = 4
		Dispersal = 3
	}
}
BIOME_RESOURCE
{
	ResourceName = H2O
	ResourceType = 0
	PlanetName = Eeloo
	BiomeName = Ice Canyons

	Distribution
	{
		PresenceChance = 30
		MinAbundance = 0.00005
		MaxAbundance = 0.0001
		Variance = 5
		Dispersal = 4
	}
}
BIOME_RESOURCE
{
	ResourceName = H2O
	ResourceType = 0
	PlanetName = Eeloo
	BiomeName = Craters

	Distribution
	{
		PresenceChance = 15
		MinAbundance = 0.00008
		MaxAbundance = 0.00012
		Variance = 8
		Dispersal = 3
	}
}
BIOME_RESOURCE
{
	ResourceName = H2O
	ResourceType = 0
	PlanetName = Eeloo
	BiomeName = Midlands

	Distribution
	{
		PresenceChance = 50
		MinAbundance = 0.0000015
		MaxAbundance = 0.00001
		Variance = 5
		Dispersal = 4
	}
}
BIOME_RESOURCE  // Highlands copy
{
	ResourceName = H2O
	ResourceType = 0
	PlanetName = Eeloo
	BiomeName = Fragipan

	Distribution
	{
		PresenceChance = 40
		MinAbundance = 0.000002
		MaxAbundance = 0.00001
		Variance = 4
		Dispersal = 3
	}
}
BIOME_RESOURCE  // Highlands copy
{
	ResourceName = H2O
	ResourceType = 0
	PlanetName = Eeloo
	BiomeName = Babbage Patch

	Distribution
	{
		PresenceChance = 40
		MinAbundance = 0.000002
		MaxAbundance = 0.00001
		Variance = 4
		Dispersal = 3
	}
}
BIOME_RESOURCE
{
	ResourceName = H2O
	ResourceType = 0
	PlanetName = Eeloo
	BiomeName = Southern Glaciers

	Distribution
	{
		PresenceChance = 100
		MinAbundance = 0.008
		MaxAbundance = 0.01
		Variance = 3
		Dispersal = 2
	}
}
BIOME_RESOURCE
{
	ResourceName = H2O
	ResourceType = 0
	PlanetName = Eeloo
	BiomeName = Mu Glaciers

	Distribution
	{
		PresenceChance = 100
		MinAbundance = 0.01
		MaxAbundance = 0.014
		Variance = 5
		Dispersal = 2
	}
}

// -- Eve --
BIOME_RESOURCE
{
	ResourceName = H2O2
	ResourceType = 0
	PlanetName = Eve
	BiomeName = Explodium Sea

	Distribution
	{
		PresenceChance = 100
		MinAbundance = 0.005
		MaxAbundance = 0.012
		Variance = 3
		Dispersal = 2
	}
}
BIOME_RESOURCE
{
	ResourceName = H2O
	ResourceType = 0
	PlanetName = Eve
	BiomeName = Poles

	Distribution
	{
		PresenceChance = 100
		MinAbundance = 0.000001
		MaxAbundance = 0.000005
		Variance = 3
		Dispersal = 2
	}
}

// -- Gilly --
//none lmao

// -- Ike --
BIOME_RESOURCE
{
	ResourceName = H2O
	ResourceType = 0
	PlanetName = Ike
	BiomeName = Polar Lowlands

	Distribution
	{
		PresenceChance = 70
		MinAbundance = 0.0000001
		MaxAbundance = 0.0000005
		Variance = 5
		Dispersal = 5
	}
}
BIOME_RESOURCE
{
	ResourceName = H2O
	ResourceType = 0
	PlanetName = Ike
	BiomeName = South Pole

	Distribution
	{
		PresenceChance = 100
		MinAbundance = 0.000001
		MaxAbundance = 0.000004
		Variance = 3
		Dispersal = 3
	}
}

// -- Jool --
//what you thought jool has a surface? this isn't ksp2

// -- Kerbin --
BIOME_RESOURCE
{
	ResourceName = H2O
	ResourceType = 0
	PlanetName = Kerbin
	BiomeName = IceCaps

	Distribution
	{
		PresenceChance = 100
		MinAbundance = 0.000005
		MaxAbundance = 0.000007
		Variance = 2
		Dispersal = 2
	}
}
BIOME_RESOURCE
{
	ResourceName = H2O
	ResourceType = 0
	PlanetName = Kerbin
	BiomeName = Northern Ice Shelf

	Distribution
	{
		PresenceChance = 100
		MinAbundance = 0.0000005
		MaxAbundance = 0.000001
		Variance = 3
		Dispersal = 3
	}
}
BIOME_RESOURCE
{
	ResourceName = H2O
	ResourceType = 0
	PlanetName = Kerbin
	BiomeName = Southern Ice Shelf

	Distribution
	{
		PresenceChance = 100
		MinAbundance = 0.0000005
		MaxAbundance = 0.000001
		Variance = 3
		Dispersal = 3
	}
}
BIOME_RESOURCE
{
	ResourceName = SiO2
	ResourceType = 0
	PlanetName = Kerbin
	BiomeName = Deserts

	Distribution
	{
		PresenceChance = 100
		MinAbundance = 0.0000009
		MaxAbundance = 0.000001
		Variance = 2
		Dispersal = 2
	}
}
BIOME_RESOURCE
{
	ResourceName = SiO2
	ResourceType = 0
	PlanetName = Kerbin
	BiomeName = Shores

	Distribution
	{
		PresenceChance = 90
		MinAbundance = 0.000000002
		MaxAbundance = 0.00000001
		Variance = 5
		Dispersal = 2
	}
}
BIOME_RESOURCE
{
	ResourceName = SiO2
	ResourceType = 0
	PlanetName = Kerbin
	BiomeName = Water

	Distribution
	{
		PresenceChance = 80
		MinAbundance = 0.000000002
		MaxAbundance = 0.00000001
		Variance = 5
		Dispersal = 2
	}
}

// -- Laythe --
BIOME_RESOURCE
{
	ResourceName = H2O
	ResourceType = 0
	PlanetName = Laythe
	BiomeName = Poles

	Distribution
	{
		PresenceChance = 100
		MinAbundance = 0.000005
		MaxAbundance = 0.000007
		Variance = 2
		Dispersal = 2
	}
}
BIOME_RESOURCE
{
	ResourceName = SiO2
	ResourceType = 0
	PlanetName = Laythe
	BiomeName = Dunes

	Distribution
	{
		PresenceChance = 100
		MinAbundance = 0.0000009
		MaxAbundance = 0.000001
		Variance = 2
		Dispersal = 2
	}
}
BIOME_RESOURCE
{
	ResourceName = SiO2
	ResourceType = 0
	PlanetName = Laythe
	BiomeName = Shores

	Distribution
	{
		PresenceChance = 90
		MinAbundance = 0.000000002
		MaxAbundance = 0.00000001
		Variance = 5
		Dispersal = 2
	}
}
BIOME_RESOURCE
{
	ResourceName = SiO2
	ResourceType = 0
	PlanetName = Laythe
	BiomeName = DeGrasse Sea

	Distribution
	{
		PresenceChance = 80
		MinAbundance = 0.000000002
		MaxAbundance = 0.00000001
		Variance = 5
		Dispersal = 2
	}
}
BIOME_RESOURCE
{
	ResourceName = SiO2
	ResourceType = 0
	PlanetName = Laythe
	BiomeName = Crater Bay

	Distribution
	{
		PresenceChance = 70
		MinAbundance = 0.0000000002
		MaxAbundance = 0.00000001
		Variance = 8
		Dispersal = 2
	}
}
BIOME_RESOURCE
{
	ResourceName = SiO2
	ResourceType = 0
	PlanetName = Laythe
	BiomeName = Shallows

	Distribution
	{
		PresenceChance = 98
		MinAbundance = 0.000000005
		MaxAbundance = 0.00000001
		Variance = 4
		Dispersal = 2
	}
}
BIOME_RESOURCE
{
	ResourceName = SiO2
	ResourceType = 0
	PlanetName = Laythe
	BiomeName = The Sagen Sea

	Distribution
	{
		PresenceChance = 80
		MinAbundance = 0.000000002
		MaxAbundance = 0.00000001
		Variance = 5
		Dispersal = 2
	}
}
BIOME_RESOURCE
{
	ResourceName = SiO2
	ResourceType = 0
	PlanetName = Laythe
	BiomeName = Crescent Bay

	Distribution
	{
		PresenceChance = 75
		MinAbundance = 0.0000000002
		MaxAbundance = 0.00000001
		Variance = 8
		Dispersal = 2
	}
}

// -- Minmus --
BIOME_RESOURCE
{
	ResourceName = H2O
	ResourceType = 0
	PlanetName = Minmus
	BiomeName = Poles

	Distribution
	{
		PresenceChance = 100
		MinAbundance = 0.00001
		MaxAbundance = 0.00005
		Variance = 4
		Dispersal = 2
	}
}

// -- Moho --
BIOME_RESOURCE
{
	ResourceName = H2O
	ResourceType = 0
	PlanetName = Moho
	BiomeName = North Pole

	Distribution
	{
		PresenceChance = 100
		MinAbundance = 0.0000001
		MaxAbundance = 0.000005
		Variance = 4
		Dispersal = 2
	}
}
BIOME_RESOURCE  // North Pole copy
{
	ResourceName = H2O
	ResourceType = 0
	PlanetName = Moho
	BiomeName = South Pole

	Distribution
	{
		PresenceChance = 100
		MinAbundance = 0.0000001
		MaxAbundance = 0.000005
		Variance = 4
		Dispersal = 2
	}
}

// -- Mun --
BIOME_RESOURCE
{
	ResourceName = H2O
	ResourceType = 0
	PlanetName = Mun
	BiomeName = Poles

	Distribution
	{
		PresenceChance = 100
		MinAbundance = 0.000001
		MaxAbundance = 0.000005
		Variance = 4
		Dispersal = 2
	}
}
BIOME_RESOURCE
{
	ResourceName = H2O
	ResourceType = 0
	PlanetName = Mun
	BiomeName = Polar Crater

	Distribution
	{
		PresenceChance = 80
		MinAbundance = 0.0000008
		MaxAbundance = 0.000001
		Variance = 6
		Dispersal = 2
	}
}
BIOME_RESOURCE
{
	ResourceName = H2O
	ResourceType = 0
	PlanetName = Mun
	BiomeName = Polar Lowlands

	Distribution
	{
		PresenceChance = 90
		MinAbundance = 0.000001
		MaxAbundance = 0.0000012
		Variance = 5
		Dispersal = 3
	}
}

// -- Pol --
BIOME_RESOURCE
{
	ResourceName = H2O
	ResourceType = 0
	PlanetName = Pol
	BiomeName = Poles

	Distribution
	{
		PresenceChance = 100
		MinAbundance = 0.00001
		MaxAbundance = 0.000014
		Variance = 3
		Dispersal = 2
	}
}

// -- Sun --
//rocks on the sun? really?

// -- Tylo --
//?????

// -- Vall --
BIOME_RESOURCE  // Pol's Poles copy
{
	ResourceName = H2O
	ResourceType = 0
	PlanetName = Vall
	BiomeName = Poles

	Distribution
	{
		PresenceChance = 100
		MinAbundance = 0.00001
		MaxAbundance = 0.000014
		Variance = 3
		Dispersal = 2
	}
}

// ----- STOCK ORE REFINING -----
@PART[ISRU]:FINAL
{
  MODULE:NEEDS[!RealSolarSystem]
	{
		name = ModuleResourceConverter
		ConverterName = Kerbin Ore Refining
		StartActionName = Start ISRU [Kerbin Ore]
		StopActionName = Stop ISRU [Kerbin Ore]
		AutoShutdown = true
		TemperatureModifier
		{
			key = 0 100000
			key = 750 50000
			key = 1000 10000
			key = 1250 500	
			key = 2000 50	
			key = 4000 0
		}				
		GeneratesHeat = true
		DefaultShutoffTemp = .8
		ThermalEfficiency 
		{
			key = 0 0 0 0
			key = 500 0.1 0 0
			key = 1000 1.0 0 0
			key = 1250 0.1 0 0
			key = 3000 0 0 0 
		}
		
		UseSpecialistBonus = true
		SpecialistEfficiencyFactor = 0.2
		SpecialistBonusBase = 0.05
		UseSpecialistHeatBonus = true
		SpecialistHeatFactor = 0.1
		ExperienceEffect = ConverterSkill
		EfficiencyBonus = 1
		resourceOutputName = Kerbin Ore Products

		 
		INPUT_RESOURCE
		{
			ResourceName = KerbinOre
			Ratio = 0.45
			FlowMode = STAGE_PRIORITY_FLOW
  	}
    INPUT_RESOURCE
		{
			ResourceName = H2O
			Ratio = 5
			FlowMode = STAGE_PRIORITY_FLOW
  	}
		INPUT_RESOURCE
		{
			ResourceName = ElectricCharge
			Ratio = 30
		}
		OUTPUT_RESOURCE
		{
			ResourceName = SiO2
			Ratio = 0.01
			DumpExcess = false
			FlowMode = STAGE_PRIORITY_FLOW
		}
	}
}
